<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BookStore</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <style>
      .container {
        margin-top: 1.5%;
        padding: 40px;
      }
    </style>
  </head>
  <body>
    <div class="container bg-white">
      <h2>Display Data</h2>
      <table class="table table-striped mt-5">
        <thead>
          <tr>
            <th scope="col">Id</th>
            <!-- <th scope="col">Name</th>
            <th scope="col">Password</th> -->
            <th scope="col">Email</th>
            <th scope="col">Division</th>
            <th scope="col">Gender</th>
            <th scope="col">Category</th>
            <th scope="col">Address</th>
            <th scope="col">Date OF Birth</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
      integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
      integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
      crossorigin="anonymous"
    ></script>

    <!-- js -->
    <script>
      // Retrieve the form data from local storage
      var storedData = localStorage.getItem("formData");

      // Parse the form data JSON string
      var formData = JSON.parse(storedData);

      // Get the table body element
      var tableBody = document.getElementById("tableBody");

      // Iterate over the form data and create table rows
      for (var i = 0; i < formData.length; i++) {
        var data = formData[i];

        // Create a table row
        var row = document.createElement("tr");

        // Create table cells for each data field
        var idCell = document.createElement("td");
        idCell.textContent = i + 1;
        row.appendChild(idCell);

        // var nameCell = document.createElement("td");
        // nameCell.textContent = data.name;
        // row.appendChild(nameCell);

        // var passwordCell = document.createElement("td");
        // passwordCell.textContent = data.password;
        // row.appendChild(passwordCell);

        var emailCell = document.createElement("td");
        emailCell.textContent = data.email;
        row.appendChild(emailCell);

        var divisionCell = document.createElement("td");
        divisionCell.textContent = data.dropdown;
        row.appendChild(divisionCell);

        var genderCell = document.createElement("td");
        genderCell.textContent = data.radio;
        row.appendChild(genderCell);

        var categoryCell = document.createElement("td");
        categoryCell.textContent = data.checkbox.join(", ");
        row.appendChild(categoryCell);

        var addressCell = document.createElement("td");
        addressCell.textContent = data.textarea;
        addressCell.style.whiteSpace = "pre-wrap"; // Apply white-space CSS property
        addressCell.style.minWidth = "10px"; // Set minimum width for the cell
        addressCell.style.maxWidth = "200px"; // Set maximum width for the cell
        row.appendChild(addressCell);

        var dobCell = document.createElement("td");
        dobCell.textContent = data.date;
        row.appendChild(dobCell);

        // Add edit button
        var editCell = document.createElement("td");
        var editButton = document.createElement("button");
        editButton.textContent = "Update";
        editButton.style.backgroundColor = "gold";
        editButton.addEventListener("click", function () {
          // Redirect to update.html page with the corresponding data
          var queryString =
            // "?name=" +
            // encodeURIComponent(data.name) +
            // "&password=" +
            // encodeURIComponent(data.password) +
            "?email=" +
            encodeURIComponent(data.email) +
            "&dropdown=" +
            encodeURIComponent(data.dropdown) +
            "&radio=" +
            encodeURIComponent(data.radio) +
            "&date=" +
            encodeURIComponent(data.date) +
            "&checkbox=" +
            encodeURIComponent(data.checkbox.join(",")) +
            "&textarea=" +
            encodeURIComponent(data.textarea);

          // Redirect to update.html with the query string
          window.location.href = "update.html" + queryString;
        });
        editCell.appendChild(editButton);
        row.appendChild(editCell);

        // Retrieve existing form data from local storage
        var storedData = localStorage.getItem("formData");
        var existingData = storedData ? JSON.parse(storedData) : [];

        // Add delete button
        var deleteCell = document.createElement("td");
        var deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.style.backgroundColor = "tomato";
        deleteButton.addEventListener("click", function () {
          // Find the index of the data object in the existingData array
          var index = existingData.findIndex(function (item) {
            return item.id === data.id && item.date === data.date;
          });
          // Check if the data object exists in the array
          if (index > -1) {
            // Remove the data object from the array
            existingData.splice(index, 1);

            // Remove the corresponding row from the table
            tableBody.removeChild(row);

            // Update the local storage with the modified data
            localStorage.setItem("formData", JSON.stringify(existingData));

          }
        });

        deleteCell.appendChild(deleteButton);
        row.appendChild(deleteCell);

        // Append the row to the table body
        tableBody.appendChild(row);
      }
    </script>
  </body>
</html>
