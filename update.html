<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BookStore</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <style>
      .container {
        background-color: #e0e4e9;
        margin-top: 10px;
        padding-bottom: 20px;
        padding-top: 10px;
        padding-left: 7%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Form Update</h2>
      <form id="formDataForm">
        <!-- <div class="form-group">
          <label for="name">Name:</label>
          <input
            type="text"
            class="form-control mb-3"
            id="name"
            style="width: 70%"
            placeholder="Enter your name"
          />
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <input
            type="password"
            class="form-control mb-3"
            id="password"
            style="width: 70%"
            placeholder="Enter your password"
          />
        </div> -->
        <div class="form-group">
          <label for="email">Email:</label>
          <input
            type="email"
            class="form-control"
            id="email"
            style="width: 70%"
            placeholder="Example@gmail.com"
          />
          <small id="error-email" class="error-message text-danger"></small>
        </div>
        <div class="form-group mt-3">
          <label for="dropdown">Division:</label>
          <select class="form-control mb-3" id="dropdown" style="width: 70%">
            <option value="" disabled selected>Select Division</option>
            <option>Dhaka</option>
            <option>Chittagong</option>
            <option>Rajshahi</option>
            <option>Sylhet</option>
            <option>Barisal</option>
            <option>Mymensingh</option>
            <option>Khulna</option>
            <option>Rangpur</option>
          </select>
        </div>
        <div class="form-group">
          <label for="radio">Gender:</label><br />
          <p id="error-gender" class="error-message text-danger"></p>
          <div class="form-check-inline">
            <label class="form-check-label">
              <input
                type="radio"
                class="form-check-input mb-3 mx-2"
                name="radio"
                value="Male"
              />Male
            </label>
          </div>
          <div class="form-check-inline">
            <label class="form-check-label">
              <input
                type="radio"
                class="form-check-input mb-3 mx-2"
                name="radio"
                value="Female"
              />Female
            </label>
          </div>
          <div class="form-check-inline mx-5">
            <label for="date" class="mb-2">Date Of Birth:</label>
            <input
              type="date"
              class="form-control"
              id="date"
              style="width: 530px"
            />
            <p id="error-date" class="error-message text-danger"></p>
          </div>
        </div>
        <div class="form-group mt-3">
          <label for="checkbox">Category:</label><br />
          <p id="error-checkbox" class="error-message text-danger"></p>
          <div class="form-check-inline mb-3">
            <label class="form-check-label">
              <input
                type="checkbox"
                class="form-check-input mx-2 mx-2"
                name="checkbox"
                value="Poetry"
              />Poetry
            </label>
          </div>
          <div class="form-check-inline">
            <label class="form-check-label">
              <input
                type="checkbox"
                class="form-check-input mx-2"
                name="checkbox"
                value="Fiction"
              />Fiction
            </label>
          </div>
          <div class="form-check-inline">
            <label class="form-check-label">
              <input
                type="checkbox"
                class="form-check-input mx-2"
                name="checkbox"
                value="Thriller"
              />Thriller
            </label>
          </div>
          <div class="form-check-inline">
            <label class="form-check-label">
              <input
                type="checkbox"
                class="form-check-input mx-2"
                name="checkbox"
                value="Fantasy"
              />Fantasy
            </label>
          </div>
          <div class="form-check-inline">
            <label class="form-check-label">
              <input
                type="checkbox"
                class="form-check-input mx-2"
                name="checkbox"
                value="Science Fiction"
              />Science Fiction
            </label>
          </div>
        </div>
        <div class="form-group">
          <label for="textarea">Address:</label>
          <textarea
            class="form-control mb-3"
            id="textarea"
            rows="4"
            style="width: 70%"
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
      integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
      integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
      crossorigin="anonymous"
    ></script>

    <!-- js -->
    <script>
      // Retrieve the query parameters from the URL
      const urlParams = new URLSearchParams(window.location.search);

      // Retrieve the values from the query parameters
      const email = urlParams.get("email");
      const dropdown = urlParams.get("dropdown");
      const radio = urlParams.get("radio");
      const date = urlParams.get("date");
      const checkbox = urlParams.get("checkbox");
      const textarea = urlParams.get("textarea");

      // Populate the input fields with the values
      document.getElementById("email").value = email;
      document.getElementById("dropdown").value = dropdown;
      document.querySelector(
        `input[name="radio"][value="${radio}"]`
      ).checked = true;
      document.getElementById("date").value = date;

      // Split the checkbox values if it's a comma-separated string
      const checkboxValues = checkbox ? checkbox.split(",") : [];

      // Check the corresponding checkboxes
      checkboxValues.forEach((value) => {
        document.querySelector(
          `input[name="checkbox"][value="${value}"]`
        ).checked = true;
      });

      document.getElementById("textarea").value = textarea;

      // Get the form element
      const form = document.querySelector("form");

      // Define error message elements
      const errorEmail = document.getElementById("error-email");
      const errorGender = document.getElementById("error-gender");
      const errorDate = document.getElementById("error-date");
      const errorCheckbox = document.getElementById("error-checkbox");

      // Validate form inputs
      function validateForm() {
        const email = document.getElementById("email").value;
        const emailRegex = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;

        const radio = document.getElementsByName("radio");
        const date = document.getElementById("date").value.trim();
        const currentDate = new Date();
        const selectedDate = new Date(date);
        const checkbox = document.querySelectorAll(
          'input[name="checkbox"]:checked'
        );

        errorEmail.textContent = "";
        errorGender.textContent = "";
        errorDate.textContent = "";
        errorCheckbox.textContent = "";

        let isValid = true;

        if (!emailRegex.test(email)) {
          errorEmail.textContent = "Invalid email address";
          isValid = false;
        }

        if (!(radio[0].checked || radio[1].checked)) {
          errorGender.textContent = "Please select a gender";
          isValid = false;
        }

        if (date === "") {
          errorDate.textContent = "Date field is required";
          isValid = false;
        } else if (selectedDate > currentDate) {
          errorDate.textContent = "Please select a date in the past or today";
          isValid = false;
        }

        if (checkbox.length === 0) {
          errorCheckbox.textContent = "Please select at least one category";
          isValid = false;
        }

        return isValid;
      }

      // Add a submit event listener to the form
      form.addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent form submission

        // Perform form validation
        if (!validateForm()) {
          return; // Stop execution if validation fails
        }

        // Get the input values
        const email = document.getElementById("email").value;
        const dropdown = document.getElementById("dropdown").value;
        const radio = document.querySelector(
          'input[name="radio"]:checked'
        ).value;
        const date = document.getElementById("date").value;
        const checkbox = Array.from(
          document.querySelectorAll('input[name="checkbox"]:checked')
        ).map((element) => element.value);
        const textarea = document.getElementById("textarea").value;

        // Retrieve existing form data from local storage
        const storedData = localStorage.getItem("formData");
        const existingData = storedData ? JSON.parse(storedData) : [];

        // Find the index of the form data to update
        let index = -1;

        existingData.forEach((data, i) => {
          if (data.email === email) {
            index = i;
            return;
          }
        });

        if (index !== -1) {
          // Update the form data at the corresponding index
          existingData[index] = {
            email: email,
            dropdown: dropdown,
            radio: radio,
            date: date,
            checkbox: checkbox,
            textarea: textarea,
          };

          // Store the updated form data in local storage
          localStorage.setItem("formData", JSON.stringify(existingData));

          alert("Form Updated Successfully");
        } else {
          alert("Form data not found for the specified email");
        }

        // Navigate to the next page
        window.location.href = "display.html";
      });
    </script>
  </body>
</html>
